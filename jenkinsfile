pipeline {
    agent any

    environment {
	AWS_REGION = "ap-south-1"
	CLUSTER_NAME = "demo-eks"
	HELM_CHART = "helm/nginx-demo"
	RELEASE_NAME = "nginx-release"
	NAMESPACE = "default"
    }

    stages {
        stage('Checkout') {
            steps {
		git branch: 'main', url: 'https://github.com/asnaga/EKSDemo.git'
		}
	}

        stage('Configure kube') {
	    steps {
		sh """
		aws eks --region $AWS_REGION update-kubeconfig --name $CLUSTER_NAME
	 	kubectl get nodes
		"""
		}
	}
	
	  stage('Helm Deploy') {
             steps {
		sh """
		helm upgrade --install $RELEASE_NAME $HELM_CHART --namespace $NAMESPACE
		"""
	  stage('Verify Deployment') {
             steps {
 		sh """
		kubectl get svc
		kubectl get pods
		"""
		}
	}
}
